<!DOCTYPE html>
<html lang="ko">
<head>
</head>
<body>
  
  <script>
    function apiCall() {
      const promise = new Promise((resolve, reject) => {

        // promise 안에서 비동기 작업
        const xhr = new XMLHttpRequest();
        // API 호출
        xhr.open('GET', 'https://jsonplaceholder.typicode.com/posts/1');
        xhr.send();

        // API 응답 처리
        // 응답이 돌아오면 onload가 실행 됨
        xhr.onload = () => {
          if(chr.status == 200) {
            const res = JSON.parse(xhr.response);
            // return res;
            resolve(res); // 성공했을 때 fillfilled 상태로 변경
          } else {
            console.error(xhr.status, xhr.statusText);
            // return;
            // 실패했을 때 fillfilled 상태로 변경
            reject(xhr.status);
          }
        }

      });

      return promise = apiCall();

      // promise 상태에 따라 작업을 진행
      // api 호출에 성공했으면 이어서 then이 실행됨
      // api 호출에 실패했으면 catch가 실행됨

      // API 호출은 비동기 방식으로 처리 됨
      // 따라서 API 호출한 후에 결과를 바로 사용할 수 없음
      // promise같은 객체를 사용하여 비동기함수를 처리해야함

      promise
      .then((response) => {
        console.log('API 성공 결과 : ',response);
      })
      .catch((status) => {
        console.log('API 실패 결과 : ${status}');
      });

      
    }
    console.log(4);
    console.log(5);

    // log는 동기식 함수
    // promise의 then은 비동기함수
    // 동기함수는 순차적으로 실행됨
    // 비동기함수는 작업이 끝났을때 실행됨

    // 만약에 API가 동기식 함수라면 어떻게 될까?
    // 서버가 응답을 줄때까지 log(4), log(5)가 실행되지 않음
    // 처리속도 지연

  </script>

</body>
</html>